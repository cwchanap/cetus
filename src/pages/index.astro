---
// Layout Import
import AppLayout from '@/layouts/AppLayout.astro'

// Component Imports
import Button from '@/components/ui/Button.astro'
import Section from '@/components/ui/Section.astro'
import Container from '@/components/ui/Container.astro'
import Heading from '@/components/ui/Heading.astro'
import Hero from '@/components/ui/Hero.astro'
import FeatureCard from '@/components/ui/FeatureCard.astro'
import GameCard from '@/components/ui/GameCard.astro'

// Games System Import
import { getAllGames, getGameIcon, type Game, GameID } from '@/lib/games'

// Check if user is authenticated
const user = Astro.locals.user

// Convert Games system data to GameCard format
function convertGameToCardFormat(game: Game) {
  // Map game IDs to legacy numeric IDs for consistency
  const idMapping: Record<string, number> = {
    tetris: 2,
    bubble_shooter: 3,
    bejeweled: 1,
    quick_math: 5,
    memory_matrix: 4,
    word_scramble: 6,
    reflex: 7,
    sudoku: 8,
    path_navigator: 9,
    evader: 10,
    snake: 11,
  }

  const difficultyLabels: Partial<Record<GameID, string>> = {
    [GameID.TETRIS]: 'Medium',
    [GameID.BUBBLE_SHOOTER]: 'Easy',
    [GameID.MEMORY_MATRIX]: 'Hard',
    [GameID.BEJEWELED]: 'Casual',
    [GameID.QUICK_MATH]: 'Math rush',
    [GameID.WORD_SCRAMBLE]: 'Word challenge',
    [GameID.REFLEX]: 'Reflex test',
    [GameID.SUDOKU]: 'Number puzzle',
    [GameID.PATH_NAVIGATOR]: 'Precision',
    [GameID.EVADER]: 'Action',
    [GameID.SNAKE]: 'Classic',
  }

  const durationLabels: Partial<Record<GameID, string>> = {
    [GameID.TETRIS]: '5-15 minutes',
    [GameID.BUBBLE_SHOOTER]: '10-20 minutes',
    [GameID.QUICK_MATH]: '1 minute',
    [GameID.MEMORY_MATRIX]: '3-10 minutes',
    [GameID.SUDOKU]: '5-20 minutes',
    [GameID.WORD_SCRAMBLE]: '60 seconds',
    [GameID.REFLEX]: '60 seconds',
    [GameID.EVADER]: '60 seconds',
    [GameID.SNAKE]: 'Endless',
  }

  const difficulty =
    difficultyLabels[game.id] ??
    game.difficulty.charAt(0).toUpperCase() + game.difficulty.slice(1)

  const baseDuration = game.estimatedDuration || '5-15 min'
  const duration = durationLabels[game.id] ?? baseDuration

  return {
    id: idMapping[game.id] || 99,
    title: game.name,
    description: game.description,
    icon: getGameIcon(game.id),
    duration,
    difficulty,
    available: game.isActive,
  }
}

// Get games from the Games system
const systemGames = getAllGames()
const availableGames = systemGames.map(convertGameToCardFormat)

const games = availableGames
---

<AppLayout
  title="Cetus - Single Player Minigames"
  description="Welcome to the ultimate single-player gaming experience. Choose from our collection of futuristic mini-games designed to challenge your skills."
>
  <!-- Hero Section -->
  <Hero
    title="MINIGAMES"
    subtitle="OF THE FUTURE"
    description="Welcome to the ultimate single-player gaming experience. Choose from our collection of <span class='text-cyan-400 font-semibold text-neon-cyan'>futuristic mini-games</span> designed to challenge your skills and create amazing gaming moments."
    primaryAction={null}
    secondaryAction={null}
  />

  <!-- Games Grid -->
  <Section id="games">
    <Container class="max-w-7xl">
      <Heading level={3} variant="section" align="center" class="mb-4">
        SELECT YOUR GAME
      </Heading>
      <p class="text-center text-gray-400 mb-12 text-lg">
        Choose from our arsenal of single-player minigames - no login required!
      </p>

      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
        {games.map(game => <GameCard game={game} user={user} />)}
      </div>
    </Container>
  </Section>

  <!-- Leaderboard Promotion Section -->
  <Section class="py-16">
    <Container class="max-w-4xl text-center">
      <div
        class="bg-gradient-to-r from-cyan-900/20 to-purple-900/20 rounded-2xl p-8 border border-cyan-400/20"
      >
        <div class="text-6xl mb-4">üèÜ</div>
        <Heading level={2} align="center" class="mb-4 text-holographic">
          COMPETE FOR GLORY
        </Heading>
        <p class="text-xl text-gray-300 mb-8">
          Think you've got what it takes? Check out the leaderboards and see how
          you stack up against players from across the galaxy!
        </p>
        <div class="flex flex-col sm:flex-row gap-4 justify-center">
          <Button variant="primary" size="lg">
            <a
              href="/leaderboard"
              class="text-white no-underline flex items-center gap-2"
            >
              <span>üéØ</span>
              View Leaderboards
            </a>
          </Button>
          <Button variant="outline" size="lg">
            <a
              href="/achievements"
              class="text-cyan-400 no-underline flex items-center gap-2"
            >
              <span>üèÖ</span>
              Achievements
            </a>
          </Button>
        </div>
      </div>
    </Container>
  </Section>

  <!-- Features Section -->
  <Section class="py-20">
    <Container>
      <Heading level={2} variant="section" align="center" class="mb-16">
        WHY CHOOSE CETUS?
      </Heading>

      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
        <FeatureCard
          icon="üöÄ"
          title="Instant Play"
          description="No downloads or registration required. Jump into any game instantly from your browser."
          variant="cyan-purple"
        />

        <FeatureCard
          icon="üåê"
          title="Cross Platform"
          description="Play seamlessly across desktop, mobile, and tablet devices."
          variant="purple-pink"
        />

        <FeatureCard
          icon="üéÆ"
          title="Skill Building"
          description="Challenge yourself and improve your skills with engaging gameplay."
          variant="pink-cyan"
        />

        <FeatureCard
          icon="üìä"
          title="Optional Progress"
          description="Login to track your scores and achievements, or just play anonymously."
          variant="cyan-purple"
        />
      </div>
    </Container>
  </Section>
</AppLayout>
