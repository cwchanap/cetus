---
import '@/styles/global.css'
import Button from '@/components/ui/Button.astro'
import Card from '@/components/ui/Card.astro'
import Badge from '@/components/ui/Badge.astro'
---

<html lang="en" class="dark">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="generator" content={Astro.generator} />
    <title>Tetris Challenge - Cetus Minigames</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
  </head>

  <body
    class="min-h-screen bg-sci-fi-dark text-white overflow-x-hidden font-inter"
  >
    <!-- Animated background -->
    <div class="fixed inset-0 pointer-events-none">
      <div
        class="absolute inset-0 bg-gradient-radial from-cyan-400/20 via-transparent to-transparent animate-pulse"
      >
      </div>
      <div
        class="absolute inset-0 bg-gradient-radial from-purple-400/20 via-transparent to-transparent animate-pulse"
        style="animation-delay: 1s;"
      >
      </div>
    </div>

    <!-- Header -->
    <header class="relative z-10 px-6 py-4 border-b border-slate-700/50">
      <nav class="max-w-7xl mx-auto flex items-center justify-between">
        <div class="flex items-center space-x-3">
          <a href="/" class="flex items-center space-x-3">
            <div
              class="w-8 h-8 bg-gradient-to-r from-cyan-400 to-purple-500 rounded-lg flex items-center justify-center shadow-lg shadow-cyan-400/25"
            >
              <span class="text-lg font-bold text-white">C</span>
            </div>
            <h1 class="text-xl font-orbitron font-bold text-holographic">
              CETUS
            </h1>
          </a>
          <div class="text-cyan-400 text-sm">/ Tetris Challenge</div>
        </div>
        <div class="flex items-center space-x-4">
          <Button variant="outline" size="sm">
            <a href="/" class="text-white no-underline flex items-center">
              <span class="mr-2">üè†</span>
              Back to Menu
            </a>
          </Button>
        </div>
      </nav>
    </header>

    <main class="relative z-10 px-6 py-8">
      <div class="max-w-6xl mx-auto">
        <!-- Game Title -->
        <div class="text-center mb-8">
          <h2 class="text-5xl font-orbitron font-bold text-holographic mb-4">
            TETRIS CHALLENGE
          </h2>
          <p class="text-gray-400 text-lg">
            Stack the blocks and clear lines in this classic puzzle game
          </p>
        </div>

        <!-- Game Container -->
        <div class="flex flex-col lg:flex-row gap-8 items-start justify-center">
          <!-- Game Board -->
          <Card variant="glass" class="p-6 flex-shrink-0">
            <div class="flex flex-col items-center space-y-4">
              <!-- Game Status -->
              <div class="flex space-x-4 mb-4">
                <Badge variant="outline" class="px-4 py-2">
                  <span class="font-mono">Score: <span id="score">0</span></span
                  >
                </Badge>
                <Badge variant="outline" class="px-4 py-2">
                  <span class="font-mono">Level: <span id="level">1</span></span
                  >
                </Badge>
                <Badge variant="outline" class="px-4 py-2">
                  <span class="font-mono">Lines: <span id="lines">0</span></span
                  >
                </Badge>
              </div>

              <!-- Tetris Game Container -->
              <div class="relative">
                <div
                  id="tetris-container"
                  class="border-2 border-cyan-400/50 bg-black/50 rounded-lg shadow-glow-cyan"
                  style="width: 300px; height: 600px;"
                >
                </div>

                <!-- Game Over Overlay -->
                <div
                  id="game-over-overlay"
                  class="absolute inset-0 bg-black/80 rounded-lg flex items-center justify-center hidden"
                >
                  <div class="text-center">
                    <h3
                      class="text-3xl font-orbitron font-bold text-red-400 mb-4"
                    >
                      GAME OVER
                    </h3>
                    <p class="text-gray-400 mb-4">
                      Final Score: <span id="final-score" class="text-cyan-400"
                        >0</span
                      >
                    </p>
                    <Button id="restart-btn" variant="primary"
                      >Play Again</Button
                    >
                  </div>
                </div>
              </div>

              <!-- Game Controls -->
              <div class="flex space-x-2">
                <Button id="start-btn" variant="primary" size="sm">Start</Button
                >
                <Button id="pause-btn" variant="outline" size="sm">Pause</Button
                >
                <Button id="reset-btn" variant="outline" size="sm">Reset</Button
                >
              </div>
            </div>
          </Card>

          <!-- Next Piece & Controls -->
          <div class="flex flex-col space-y-6">
            <!-- Next Piece -->
            <Card variant="glass" class="p-6">
              <h3
                class="text-lg font-orbitron font-bold text-cyan-400 mb-4 text-center"
              >
                NEXT PIECE
              </h3>
              <canvas
                id="next-canvas"
                width="120"
                height="120"
                class="border border-cyan-400/30 bg-black/30 rounded-lg mx-auto block"
              ></canvas>
            </Card>

            <!-- Controls Guide -->
            <Card variant="glass" class="p-6">
              <h3 class="text-lg font-orbitron font-bold text-cyan-400 mb-4">
                CONTROLS
              </h3>
              <div class="space-y-2 text-sm">
                <div class="flex justify-between">
                  <span class="text-gray-400">Move Left:</span>
                  <Badge variant="outline" class="px-2 py-1 text-xs">‚Üê</Badge>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-400">Move Right:</span>
                  <Badge variant="outline" class="px-2 py-1 text-xs">‚Üí</Badge>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-400">Soft Drop:</span>
                  <Badge variant="outline" class="px-2 py-1 text-xs">‚Üì</Badge>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-400">Hard Drop:</span>
                  <Badge variant="outline" class="px-2 py-1 text-xs"
                    >Space</Badge
                  >
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-400">Rotate:</span>
                  <Badge variant="outline" class="px-2 py-1 text-xs">‚Üë</Badge>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-400">Pause:</span>
                  <Badge variant="outline" class="px-2 py-1 text-xs">P</Badge>
                </div>
              </div>
            </Card>

            <!-- Statistics -->
            <Card variant="glass" class="p-6">
              <h3 class="text-lg font-orbitron font-bold text-cyan-400 mb-4">
                STATISTICS
              </h3>
              <div class="space-y-2 text-sm">
                <div class="flex justify-between">
                  <span class="text-gray-400">Pieces:</span>
                  <span id="pieces-count" class="text-white">0</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-400">Singles:</span>
                  <span id="singles-count" class="text-white">0</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-400">Doubles:</span>
                  <span id="doubles-count" class="text-white">0</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-400">Triples:</span>
                  <span id="triples-count" class="text-white">0</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-400">Tetrises:</span>
                  <span id="tetrises-count" class="text-cyan-400">0</span>
                </div>
              </div>
            </Card>
          </div>
        </div>
      </div>
    </main>

    <!-- Tetris Game Logic -->
    <script>
      import { initTetrisGame } from '@/lib/games/tetris/init'

      // Initialize game when page loads
      document.addEventListener('DOMContentLoaded', async () => {
        await initTetrisGame()
      })
    </script>
  </body>
</html>
